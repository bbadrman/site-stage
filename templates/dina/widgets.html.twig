{% extends 'dina_base.html.twig' %}

{% block title %}Widgets{% endblock %}

{% block stylesheets %}
  <link rel="stylesheet" href="{{ asset('css/widgets.css') }}">
{% endblock %}

{% block body %}
<section class="w-page">
  <div class="w-bg"></div>

  <div class="w-wrap">
    <div class="w-hero">
      <h1>Financial Widgets</h1>
      <p>
        دابا غادي نديرو Widgets بواجهة نظيفة بحال اللي فالصورة (Symfony + CSS + JS)
      </p>
    </div>

    <!-- BIG CARD -->
    <article class="w-card w-card--big">
      <div class="w-top">
        <h2>Tech Giants <span class="w-step">(2/7)</span></h2>

        <div class="w-progress">
          <span class="w-bar" style="width: 52%"></span>
        </div>
      </div>

      <div class="w-tabs" data-tabs>
        <button class="w-pill active" data-symbol="NVDA">NVDA</button>
        <button class="w-pill" data-symbol="AAPL">AAPL</button>
        <button class="w-pill" data-symbol="MSFT">MSFT</button>
        <button class="w-pill" data-symbol="AMZN">AMZN</button>
        <button class="w-pill" data-symbol="GOOGL">GOOGL</button>
        <button class="w-pill" data-symbol="META">META</button>
        <button class="w-pill" data-symbol="TSLA">TSLA</button>
      </div>

      <div class="w-chart">
        <div class="w-chart-grid"></div>
        <svg class="w-line" viewBox="0 0 900 260" preserveAspectRatio="none" aria-label="chart">
          <path id="wPath" d=""></path>
        </svg>
      </div>

      <div class="w-meta">
        <div class="w-meta-left">
          <span class="w-badge" id="wSym">AAPL</span>
          <strong id="wPrice">265,36</strong>
          <span class="w-chg up" id="wChg">+1,48 (0,56%)</span>
        </div>

        <div class="w-meta-right">
          <span>Day Hi/Lo: <b id="wHL">265,94 / 262,48</b></span>
          <span>Volume: <b id="wVol">533.97K</b></span>
          <span>At: <b id="wAt">18 févr. 2026</b></span>
        </div>
      </div>

      <div class="w-range" data-range>
        <button class="w-range-btn" data-r="1D">1D</button>
        <button class="w-range-btn" data-r="5D">5D</button>
        <button class="w-range-btn active" data-r="1M">1M</button>
        <button class="w-range-btn" data-r="6M">6M</button>
        <button class="w-range-btn" data-r="YTD">YTD</button>
        <button class="w-range-btn" data-r="1Y">1Y</button>
        <button class="w-range-btn" data-r="5Y">5Y</button>
        <button class="w-range-btn" data-r="ALL">ALL</button>
      </div>
    </article>

    <!-- MARKET LIST -->
    <section class="w-market">
      <div class="w-market-head">
        <h3>Today's Market</h3>

        <div class="w-controls">
          <div class="w-toggle" data-toggle>
            <button class="active" data-mode="intraday">Intraday</button>
            <button data-mode="daily">Daily</button>
          </div>
          <button class="w-refresh" id="wRefresh">Refresh</button>
        </div>
      </div>

      <div class="w-list" id="wList">
        <!-- JS كيعمّرها -->
      </div>

      <p class="w-madeby">Crafted for Aksam</p>
    </section>

    <!-- CRYPTO TICKER -->
    <section class="w-ticker" aria-label="crypto ticker">
      <div class="w-ticker-fade left"></div>
      <div class="w-ticker-fade right"></div>

      <div class="w-track" id="wTrack">
        <div class="w-run" id="wRun">
          <!-- JS -->
        </div>
      </div>
    </section>
  </div>
</section>
{% endblock %}

{% block javascripts %}
  <script>
    // ====== Fake data (باش غير يبان الUI بحال الصورة) ======
    const market = [
      { sym:"AAPL", price:"262,81", chg:"-0,94 (-0,36%)", dir:"down" },
      { sym:"MSFT", price:"400,67", chg:"+3,88 (0,98%)", dir:"up" },
      { sym:"NVDA", price:"188,50", chg:"+3,52 (1,9%)", dir:"up" },
      { sym:"AMZN", price:"206,52", chg:"+0,67 (0,33%)", dir:"up" },
      { sym:"GOOGL", price:"303,91", chg:"+1,21 (0,4%)", dir:"up" },
      { sym:"TSLA", price:"413,89", chg:"+0,65 (0,16%)", dir:"up" },
      { sym:"META", price:"633,15", chg:"-0,8 (-0,13%)", dir:"down" },
    ];

    const crypto = [
      { sym:"BTC", chg:"▼ 0,5%" },
      { sym:"ETH", chg:"▼ 1,2%" },
      { sym:"SOL", chg:"▼ 3,4%" },
      { sym:"XRP", chg:"▼ 1,0%" },
      { sym:"ADA", chg:"▼ 0,0%" },
      { sym:"DOGE", chg:"▼ 0,6%" },
      { sym:"AVAX", chg:"▼ 1,1%" },
      { sym:"LINK", chg:"▼ 1,4%" },
    ];

    // ====== Market list render ======
    const list = document.getElementById("wList");
    function spark(dir){
      // mini sparkline svg (simple)
      const p = dir === "up"
        ? "M2,26 L10,18 L18,22 L26,10 L34,14 L42,6 L50,9 L58,4 L66,8 L74,3 L82,6 L90,2"
        : "M2,4 L10,10 L18,7 L26,15 L34,12 L42,20 L50,18 L58,24 L66,22 L74,26 L82,23 L90,27";
      return `
        <svg viewBox="0 0 92 30" class="w-spark ${dir}">
          <path d="${p}" />
          <path class="fill" d="${p} L90,30 L2,30 Z" />
        </svg>`;
    }
    function renderMarket(){
      list.innerHTML = market.map(m => `
        <article class="w-item">
          <div class="w-item-left">
            <div class="w-dot ${m.dir}"></div>
            <div>
              <div class="w-sym">${m.sym}</div>
              <div class="w-price">${m.price} <span class="w-usd">USD</span></div>
              <div class="w-change ${m.dir}">${m.chg}</div>
              <div class="w-time">15:30:00</div>
            </div>
          </div>
          <div class="w-item-right">
            <div class="w-tag">Intraday</div>
            ${spark(m.dir)}
          </div>
        </article>
      `).join("");
    }
    renderMarket();

    // ====== Ticker render ======
    const run = document.getElementById("wRun");
    function renderTicker(){
      const line = crypto.map(c => `
        <span class="w-tk">
          <b>${c.sym}</b> <i>${c.chg}</i>
        </span>
      `).join("");
      // duplicate for infinite loop effect
      run.innerHTML = `<div class="w-row">${line}</div><div class="w-row">${line}</div>`;
    }
    renderTicker();

    // ====== Tabs ======
    const tabs = document.querySelector("[data-tabs]");
    tabs.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if(!btn) return;
      tabs.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById("wSym").textContent = btn.dataset.symbol;
    });

    // ====== Range buttons ======
    const range = document.querySelector("[data-range]");
    range.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if(!btn) return;
      range.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    });

    // ====== Toggle ======
    const toggle = document.querySelector("[data-toggle]");
    toggle.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if(!btn) return;
      toggle.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    });

    // ====== Refresh (fake) ======
    document.getElementById("wRefresh").addEventListener("click", () => {
      list.classList.add("flash");
      setTimeout(()=>list.classList.remove("flash"), 450);
    });

    // ====== Draw simple line path for big chart ======
    function makePath(){
      const pts = [30,120,60,140,100,110,140,150,190,90,240,95,290,70,340,80,390,45,440,60,490,40,540,55,590,35,640,48,690,30,740,44,790,28,840,58,880,46];
      let d = `M ${pts[0]} ${pts[1]}`;
      for(let i=2;i<pts.length;i+=2){
        d += ` L ${pts[i]} ${pts[i+1]}`;
      }
      document.getElementById("wPath").setAttribute("d", d);
    }
    makePath();
  </script>
{% endblock %}
